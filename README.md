# example-app
docker-compose, reactjs, postgresql, nginx and postgrest

This is an example application with an autogenerated backend using postgrest
on kubernetes. I have been telling people they d0 not need ops people, that they
do not need custom backends, that they just need sql and js. Hopefully here is some
proof.

The frontend can be built into a nginx container and deployed
via kubernetes. The backend is dyanmically controlled via postgresql and 
postgrest.
https://postgrest.com

Although we use a docker-compose locally, we automatically support
deployment to kubernetes with kompose to staging. We don't support auto deploy
to production for a couple of reasons listed below. You'll want to setup a real
production postgresql so you don't lose data on deploy.

- No one should deploy to production k8s without being a kubectl expert
- Hopefully you aren't using a docker postgresql included as it's ephemeral an not backed up
- You already have the k8s files so you'll have no trouble using them directly


TODO
--------
- [ ] Add jwt
- [ ] Add ssl support
- [ ] Add deploy to production instructions

Preinstall
--------

You will need 

 - pip
 - A new version docker https://docs.docker.com/engine/installation/linux/ubuntu/#install-docker

install docker compose using pip

```
pip install docker-compose
```
You will need an external load balancer ip. Also you will want to put cloudflare in front of everything
This will give you ok ssl support, but it's not super secure as the link to cloudflare would be unencrypted.
They terminate it and are owned by the CIA anyway :)

Configuration
--------
We try to keep it easy for you. Pretty much everything
which is not stored secrets is done for you.
You'll need to fill in the image names in docker-compose.yaml and
 in the bin scripts, and you really should understand those scripts 
 before using this at all.


Frontend
--------
We generated this frontend using
```
npm install -g create-react-app
```
You can use yarn to manage the server.
```
  yarn start
```
    Starts the development server.

```
  yarn build
```
    Bundles the app into static files for production.

```
  yarn test
```
    Starts the test runner.

```
  yarn eject
```
    Removes this tool and copies build dependencies, configuration files
    and scripts into the app directory. If you do this, you canâ€™t go back!


Backend Interace
--------

Not much to do


Nginx Proxy
--------

This is what actually servers our site. The generated source maps are 
proected by password. The current password username and password is password
. You can change them by updating the htaccess file
https://www.web2generators.com/apache-tools/htpasswd-generator


Postgresql
--------

The database we store our data in.
